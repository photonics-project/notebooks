(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4187],{47071:(e,t,s)=>{"use strict";s.d(t,{H5:()=>o,Ix:()=>l,f:()=>a});var i,n=s(50715),r=(s(28748),s(31256));function o(e,t,s){return e.rename(t,s).catch((i=>{if(409!==i.response.status)throw i;return a(s).then((i=>i?e.overwrite(t,s):Promise.reject("File not renamed")))}))}function a(e,t){const s=(t=t||r.nullTranslator).load("jupyterlab"),i={title:s.__("Overwrite file?"),body:s.__('"%1" already exists, overwrite?',e),buttons:[n.Dialog.cancelButton(),n.Dialog.warnButton({label:s.__("Overwrite"),ariaLabel:s.__("Overwrite Existing File")})]};return(0,n.showDialog)(i).then((e=>Promise.resolve(e.button.accept)))}function l(e){return e.length>0&&!/[\/\\:]/.test(e)}s(80281).Widget,function(e){e.createRenameNode=function(e,t){const s=(t=t||r.nullTranslator).load("jupyterlab"),i=document.createElement("div"),n=document.createElement("label");n.textContent=s.__("File Path");const o=document.createElement("span");o.textContent=e;const a=document.createElement("label");a.textContent=s.__("New Name"),a.className="jp-new-name-title";const l=document.createElement("input");return i.appendChild(n),i.appendChild(o),i.appendChild(a),i.appendChild(l),i}}(i||(i={}))},84187:(e,t,s)=>{"use strict";s.r(t),s.d(t,{RenderedCells:()=>E,ThemeManager:()=>j,VoilaApp:()=>p,VoilaDirListing:()=>De,VoilaFileBrowser:()=>Ie,VoilaShell:()=>m,activePlugins:()=>U,createModule:()=>B,loadComponent:()=>A,loadScript:()=>T,pathsPlugin:()=>g,renderOutputsPlugin:()=>L,shouldUseMathJax2:()=>R,themePlugin:()=>F,themesManagerPlugin:()=>O,translatorPlugin:()=>f,widgetManager:()=>x});var i,n=s(68211),r=s(28250),o=s(28748),a=s(45945),l=s(60731),d=s(71277),h=s(30427),c=s(80281);class m extends c.Widget{constructor(){super(),this._layoutDebouncer=new d.Debouncer((()=>{this._layoutModified.emit(void 0)}),0),this._layoutModified=new h.Signal(this),this.id="main";const e=new c.BoxLayout;e.alignment="start",e.spacing=0,this.addClass("jp-LabShell");const t=this._topHandler=new i.PanelHandler;t.panel.id="voila-top-panel",t.panel.node.setAttribute("role","banner"),c.BoxLayout.setStretch(t.panel,0),t.panel.hide(),e.addWidget(t.panel);const s=this._mainPanel=new c.BoxPanel;s.id="jp-main-content-panel",s.direction="top-to-bottom",c.BoxLayout.setStretch(s,1),e.addWidget(s);const n=this._bottomPanel=new c.Panel;n.node.setAttribute("role","contentinfo"),n.id="voila-bottom-panel",c.BoxLayout.setStretch(n,0),e.addWidget(n),n.hide(),this.layout=e}get currentWidget(){return this._mainPanel.widgets[0]}activateById(e){}add(e,t,s){switch(t){case"top":this._addToTopArea(e,s);break;case"bottom":this._addToBottomArea(e,s);break;case"main":this._mainPanel.addWidget(e);break;default:console.warn(`Area ${t} is not implemented yet!`)}}widgets(e){switch(e){case"top":return this._topHandler.panel.children();case"bottom":return this._bottomPanel.children();case"main":this._mainPanel.children();break;default:return[][Symbol.iterator]()}return[][Symbol.iterator]()}_addToTopArea(e,t){var s;if(!e.id)return void console.error("Widgets added to app shell must have unique id property.");const i=null!==(s=(t=t||{}).rank)&&void 0!==s?s:900;this._topHandler.addWidget(e,i),this._onLayoutModified(),this._topHandler.panel.isHidden&&this._topHandler.panel.show()}_addToBottomArea(e,t){e.id?(this._bottomPanel.addWidget(e),this._onLayoutModified(),this._bottomPanel.isHidden&&this._bottomPanel.show()):console.error("Widgets added to app shell must have unique id property.")}_onLayoutModified(){this._layoutDebouncer.invoke()}}!function(e){e.itemCmp=function(e,t){return e.rank-t.rank},e.PanelHandler=class{constructor(){this._panelChildHook=(e,t)=>{switch(t.type){case"child-added":{const e=t.child;if(this._items.find((t=>t.widget===e)))break;const s=this._items[this._items.length-1].rank;this._items.push({widget:e,rank:s})}break;case"child-removed":{const e=t.child;a.ArrayExt.removeFirstWhere(this._items,(t=>t.widget===e))}}return!0},this._items=new Array,this._panel=new c.Panel,l.MessageLoop.installMessageHook(this._panel,this._panelChildHook)}get panel(){return this._panel}addWidget(t,s){t.parent=null;const i={widget:t,rank:s},n=a.ArrayExt.upperBound(this._items,i,e.itemCmp);a.ArrayExt.insert(this._items,n,i),this._panel.insertWidget(n,t)}}}(i||(i={}));const u=s(89452);class p extends r.JupyterFrontEnd{constructor(e){var t;if(super(Object.assign(Object.assign({},e),{shell:null!==(t=e.shell)&&void 0!==t?t:new m})),this.name="Voila",this.namespace=this.name,this.version=u.version,this._widgetManager=null,this._widgetManagerPromise=new n.PromiseDelegate,e.mimeExtensions)for(const t of(0,r.createRendermimePlugins)(e.mimeExtensions))this.registerPlugin(t)}get paths(){return{urls:{base:o.PageConfig.getOption("baseUrl"),notFound:o.PageConfig.getOption("notFoundUrl"),app:o.PageConfig.getOption("appUrl"),static:o.PageConfig.getOption("staticUrl"),settings:o.PageConfig.getOption("settingsUrl"),themes:o.PageConfig.getOption("themesUrl"),doc:o.PageConfig.getOption("docUrl"),translations:o.PageConfig.getOption("translationsApiUrl"),hubHost:o.PageConfig.getOption("hubHost")||void 0,hubPrefix:o.PageConfig.getOption("hubPrefix")||void 0,hubUser:o.PageConfig.getOption("hubUser")||void 0,hubServerName:o.PageConfig.getOption("hubServerName")||void 0},directories:{appSettings:o.PageConfig.getOption("appSettingsDir"),schemas:o.PageConfig.getOption("schemasDir"),static:o.PageConfig.getOption("staticDir"),templates:o.PageConfig.getOption("templatesDir"),themes:o.PageConfig.getOption("themesDir"),userSettings:o.PageConfig.getOption("userSettingsDir"),serverRoot:o.PageConfig.getOption("serverRoot"),workspaces:o.PageConfig.getOption("workspacesDir")}}}registerPluginModule(e){let t=e.default;Object.prototype.hasOwnProperty.call(e,"__esModule")||(t=e),Array.isArray(t)||(t=[t]),t.forEach((e=>{try{this.registerPlugin(e)}catch(e){console.error(e)}}))}registerPluginModules(e){e.forEach((e=>{this.registerPluginModule(e)}))}get widgetManagerPromise(){return this._widgetManagerPromise}set widgetManager(e){this._widgetManager=e,this._widgetManager&&this._widgetManagerPromise.resolve(this._widgetManager)}get widgetManager(){return this._widgetManager}}const g={id:"@voila-dashboards/voila:paths",activate:e=>e.paths,autoStart:!0,provides:r.JupyterFrontEnd.IPaths};var _=s(31256);const f={id:"@voila-dashboards/voila:translator",activate:e=>new _.TranslationManager,autoStart:!0,provides:_.ITranslator};var v=s(15666),y=s(6769),b=s(12456),w=s(15074),C=s(2740);class E extends c.Widget{processMessage(e){super.processMessage(e),"resize"===e.type&&window.dispatchEvent(new Event("resize"))}}const P="application/vnd.jupyter.widget-view+json",x={id:"@voila-dashboards/voila:widget-manager",autoStart:!0,requires:[v.IRenderMimeRegistry],provides:C.IJupyterWidgetRegistry,activate:async(e,t)=>{if(!(e instanceof p))throw Error("The Voila Widget Manager plugin must be activated in a VoilaApp");const s=o.PageConfig.getBaseUrl(),i=o.PageConfig.getOption("kernelId"),n=y.ServerConnection.makeSettings({baseUrl:s}),r=await y.KernelAPI.getKernelModel(i,n);if(!r)return{registerWidget(e){throw Error(`The model for kernel id ${i} does not exist`)}};const a=new b.KernelConnection({model:r,serverSettings:n}),l=new w.KernelWidgetManager(a,t);return e.widgetManager=l,t.removeMimeType(P),t.addFactory({safe:!1,mimeTypes:[P],createRenderer:e=>new w.WidgetRenderer(e,l)},-10),window.addEventListener("beforeunload",(e=>{const t=new FormData,i=document.cookie.match("\\b_xsrf=([^;]*)\\b"),n=i&&i[1]||"";t.append("_xsrf",n),window.navigator.sendBeacon(`${s}voila/api/shutdown/${a.id}`,t),a.dispose()})),{registerWidget:async t=>{(await e.widgetManagerPromise.promise).register(t)}}}},L={id:"@voila-dashboards/voila:render-outputs",autoStart:!0,requires:[v.IRenderMimeRegistry,C.IJupyterWidgetRegistry],activate:async(e,t)=>{var s;await(null===(s=t.latexTypesetter)||void 0===s?void 0:s.typeset(document.createElement("div"))),document.body.querySelectorAll("div.jp-MarkdownOutput").forEach((e=>{var s;null===(s=t.latexTypesetter)||void 0===s||s.typeset(e)})),document.body.querySelectorAll('script[type="application/vnd.voila.cell-output+json"]').forEach((async e=>{const s=JSON.parse(e.innerHTML),i=t.preferredMimeType(s.data,"any");if(!i)return null;const n=t.createRenderer(i);if(n.renderModel(s).catch((e=>{const t=document.createElement("pre");t.textContent=`Javascript Error: ${e.message}`,n.node.appendChild(t),t.className="lm-Widget jp-RenderedText",t.setAttribute("data-mime-type","application/vnd.jupyter.stderr")})),n.addClass("jp-OutputArea-output"),e.parentElement){const t=e.parentElement;t.removeChild(e),c.Widget.attach(n,t)}}));const i=document.getElementById("rendered_cells");if(i){const t=new E({node:i});e.shell.add(t,"main")}}};var D=s(83459),I=s(50715),k=s(74173),S=s(49711);const M="JupyterLab Light";class j{constructor(e){this._current=null,this._links=[],this._overrides={},this._overrideProps={},this._outstanding=null,this._pending=0,this._requests={},this._themes={},this._themeChanged=new h.Signal(this),this._requestedTheme=M;const{host:t,url:s}=e;this.translator=e.translator||_.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._base=s,this._host=t}get theme(){return this._current}get themes(){return Object.keys(this._themes)}get themeChanged(){return this._themeChanged}getCSS(e){var t;return null!==(t=this._overrides[e])&&void 0!==t?t:getComputedStyle(document.documentElement).getPropertyValue(`--jp-${e}`)}loadCSS(e){const t=this._base,s=o.URLExt.isLocal(e)?o.URLExt.join(t,e):e,i=this._links;return new Promise(((e,t)=>{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",s),n.addEventListener("load",(()=>{e(void 0)})),n.addEventListener("error",(()=>{t(`Stylesheet failed to load: ${s}`)})),document.body.appendChild(n),i.push(n),this.loadCSSOverrides()}))}loadCSSOverrides(){this._overrides={}}validateCSS(e,t){const s=this._overrideProps[e];return s?!!CSS.supports(s,t)||(console.warn(`CSS validation failed: invalid value.\nkey: '${e}', val: '${t}', prop: '${s}'`),!1):(console.warn(`CSS validation failed: could not find property corresponding to key.\nkey: '${e}', val: '${t}'`),!1)}register(e){const{name:t}=e,s=this._themes;if(s[t])throw new Error(`Theme already registered for ${t}`);return s[t]=e,this._themeChanged.emit({name:"",oldValue:null,newValue:""}),new S.DisposableDelegate((()=>{delete s[t]}))}async setTheme(e){this._requestedTheme=e,this._loadSettings()}isLight(e){return this._themes[e].isLight}themeScrollbars(e){return!1}getDisplayName(e){var t,s;return null!==(s=null===(t=this._themes[e])||void 0===t?void 0:t.displayName)&&void 0!==s?s:e}_loadSettings(){const e=this._outstanding,t=this._pending,s=this._requests;t&&(window.clearTimeout(t),this._pending=0);const i=this._themes,n=this._requestedTheme;if(e)return e.then((()=>{this._loadSettings()})).catch((()=>{this._loadSettings()})),void(this._outstanding=null);if(s[n]=s[n]?s[n]+1:1,i[n])return this._outstanding=this._loadTheme(n),void delete s[n];if(s[n]>20){const e=M;return delete s[n],i[e]?(console.warn(`Could not load theme ${n}, using default ${e}.`),void(this._outstanding=this._loadTheme(e))):void this._onError(this._trans.__("Neither theme %1 nor default %2 loaded.",n,e))}this._pending=window.setTimeout((()=>{this._loadSettings()}),75)}_loadTheme(e){const t=this._current,s=this._links,i=this._themes,n=new S.DisposableDelegate((()=>{}));s.forEach((e=>{e.parentElement&&e.parentElement.removeChild(e)})),s.length=0;const r=t?i[t].unload():Promise.resolve();return Promise.all([r,i[e].load()]).then((()=>{this._current=e,this._themeChanged.emit({name:"theme",oldValue:t,newValue:e}),this._host&&(this._host.hide(),requestAnimationFrame((()=>{this._host.show(),N.fitAll(this._host),n.dispose()})))})).catch((e=>{this._onError(e),n.dispose()}))}_onError(e){(0,I.showDialog)({title:this._trans.__("Error Loading Theme"),body:String(e),buttons:[I.Dialog.okButton({label:this._trans.__("OK")})]})}}var N;!function(e){e.fitAll=function e(t){for(const s of t.children())e(s);t.fit()}}(N||(N={}));const O={id:"@voila-dashboards/voila:theme-manager",description:"Provides the theme manager.",requires:[r.JupyterFrontEnd.IPaths],activate:(e,t)=>{const s=e.shell,i=o.URLExt.join(o.PageConfig.getBaseUrl(),t.urls.themes),n=new j({host:s,url:i});let r;return n.themeChanged.connect(((e,t)=>{r=t.newValue,r.length>0&&(document.body.dataset.jpThemeLight=String(n.isLight(r)),document.body.dataset.jpThemeName=r)})),n},autoStart:!0,provides:I.IThemeManager},F={id:"@voila-dashboards/voila:theme",autoStart:!0,optional:[I.IThemeManager],activate:async(e,t)=>{if(k.ll.module&&D.G.mount(document,k.ll.module),!t)return;const s=o.PageConfig.getOption("jupyterLabTheme")||"light";"dark"!==s&&"light"!==s&&await t.setTheme(s),window.themeLoaded=!0,window.cellLoaded&&window.voila_finish()}};function T(e){return new Promise(((t,s)=>{const i=document.createElement("script");i.onerror=s,i.onload=t,i.async=!0,document.head.appendChild(i),i.src=e}))}async function A(e,t){await T(e),await s.I("default");const i=window._JUPYTERLAB[t];await i.init(s.S.default)}async function B(e,t){try{return(await window._JUPYTERLAB[e].get(t))()}catch(s){throw console.warn(`Failed to create module: package: ${e}; module: ${t}`),s}}function*U(e,t){let s;s=Object.prototype.hasOwnProperty.call(e,"__esModule")?e.default:e;const i=Array.isArray(s)?s:[s];for(const e of i)o.PageConfig.Extension.isDisabled(e.id)||t.includes(e.id)||t.includes(e.id.split(":")[0])||(yield e)}function R(){const[e,t]=["fullMathjaxUrl","mathjaxConfig"],s=o.PageConfig.getOption(e),i=o.PageConfig.getOption(t);return("null"!==s||"null"!==i)&&(o.PageConfig.setOption(e,"null"===s?"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js":s),o.PageConfig.setOption(t,"null"===i?"TeX-AMS_CHTML-full,Safe":i),!0)}var W=s(15388),H=s(47071),K=s(72363);const z="jp-BreadCrumbs-home",V="jp-BreadCrumbs-preferred",$="jp-BreadCrumbs-item",q=["/","../../","../",""],J="application/x-jupyter-icontents",Y="jp-mod-dropTarget";class X extends c.Widget{constructor(e){super(),this._previousState=null,this.translator=e.translator||_.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._model=e.model,this._fullPath=e.fullPath||!1,this.addClass("jp-BreadCrumbs"),this._crumbs=G.createCrumbs(),this._crumbSeps=G.createCrumbSeparators();const t=o.PageConfig.getOption("preferredPath");this._hasPreferred=!(!t||"/"===t),this._hasPreferred&&this.node.appendChild(this._crumbs[G.Crumb.Preferred]),this.node.appendChild(this._crumbs[G.Crumb.Home]),this._model.refreshed.connect(this.update,this)}handleEvent(e){switch(e.type){case"click":this._evtClick(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:return}}get fullPath(){return this._fullPath}set fullPath(e){this._fullPath=e}onAfterAttach(e){super.onAfterAttach(e),this.update();const t=this.node;t.addEventListener("click",this),t.addEventListener("lm-dragenter",this),t.addEventListener("lm-dragleave",this),t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node;t.removeEventListener("click",this),t.removeEventListener("lm-dragenter",this),t.removeEventListener("lm-dragleave",this),t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this)}onUpdateRequest(e){const t={path:this._model.manager.services.contents.localPath(this._model.path),hasPreferred:this._hasPreferred,fullPath:this._fullPath};this._previousState&&n.JSONExt.deepEqual(t,this._previousState)||(this._previousState=t,G.updateCrumbs(this._crumbs,this._crumbSeps,t))}_evtClick(e){if(0!==e.button)return;let t=e.target;for(;t&&t!==this.node;){if(t.classList.contains(V))return this._model.cd(o.PageConfig.getOption("preferredPath")).catch((e=>(0,I.showErrorMessage)(this._trans.__("Open Error"),e))),e.preventDefault(),void e.stopPropagation();if(t.classList.contains($)||t.classList.contains(z)){let s=a.ArrayExt.findFirstIndex(this._crumbs,(e=>e===t)),i=q[s];return this._fullPath&&s<0&&!t.classList.contains(z)&&(i=t.title),this._model.cd(i).catch((e=>(0,I.showErrorMessage)(this._trans.__("Open Error"),e))),e.preventDefault(),void e.stopPropagation()}t=t.parentElement}}_evtDragEnter(e){if(e.mimeData.hasData(J)){const t=a.ArrayExt.findFirstIndex(this._crumbs,(t=>K.ElementExt.hitTest(t,e.clientX,e.clientY)));-1!==t&&t!==G.Crumb.Current&&(this._crumbs[t].classList.add(Y),e.preventDefault(),e.stopPropagation())}}_evtDragLeave(e){e.preventDefault(),e.stopPropagation();const t=I.DOMUtils.findElement(this.node,Y);t&&t.classList.remove(Y)}_evtDragOver(e){e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=I.DOMUtils.findElement(this.node,Y);t&&t.classList.remove(Y);const s=a.ArrayExt.findFirstIndex(this._crumbs,(t=>K.ElementExt.hitTest(t,e.clientX,e.clientY)));-1!==s&&this._crumbs[s].classList.add(Y)}_evtDrop(e){if(e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");if(!e.mimeData.hasData(J))return;e.dropAction=e.proposedAction;let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(Y)){t.classList.remove(Y);break}t=t.parentElement}const s=a.ArrayExt.findFirstIndex(this._crumbs,(e=>e===t));if(-1===s)return;const i=this._model,n=o.PathExt.resolve(i.path,q[s]),r=i.manager,l=[],d=e.mimeData.getData(J);for(const e of d){const t=r.services.contents.localPath(e),s=o.PathExt.basename(t),i=o.PathExt.join(n,s);l.push((0,H.H5)(r,e,i))}Promise.all(l).catch((e=>(0,I.showErrorMessage)(this._trans.__("Move Error"),e)))}}var G;!function(e){let t;!function(e){e[e.Home=0]="Home",e[e.Ellipsis=1]="Ellipsis",e[e.Parent=2]="Parent",e[e.Current=3]="Current",e[e.Preferred=4]="Preferred"}(t=e.Crumb||(e.Crumb={})),e.updateCrumbs=function(e,s,i){const n=e[0].parentNode,r=n.firstChild;for(;r&&r.nextSibling;)n.removeChild(r.nextSibling);i.hasPreferred?(n.appendChild(e[t.Home]),n.appendChild(s[0])):n.appendChild(s[0]);const o=i.path.split("/");if(!i.fullPath&&o.length>2){n.appendChild(e[t.Ellipsis]);const i=o.slice(0,o.length-2).join("/");e[t.Ellipsis].title=i,n.appendChild(s[1])}if(i.path)if(i.fullPath)for(let e=0;e<o.length;e++){const t=document.createElement("span");t.className=$,t.textContent=o[e];const s=`/${o.slice(0,e+1).join("/")}`;t.title=s,n.appendChild(t);const i=document.createElement("span");i.textContent="/",n.appendChild(i)}else{if(o.length>=2){e[t.Parent].textContent=o[o.length-2],n.appendChild(e[t.Parent]);const i=o.slice(0,o.length-1).join("/");e[t.Parent].title=i,n.appendChild(s[2])}e[t.Current].textContent=o[o.length-1],n.appendChild(e[t.Current]),e[t.Current].title=i.path,n.appendChild(s[3])}},e.createCrumbs=function(){const e=W.folderIcon.element({className:z,tag:"span",title:o.PageConfig.getOption("serverRoot")||"Jupyter Server Root",stylesheet:"breadCrumb"}),t=W.ellipsesIcon.element({className:$,tag:"span",stylesheet:"breadCrumb"}),s=document.createElement("span");s.className=$;const i=document.createElement("span");return i.className=$,[e,t,s,i,W.homeIcon.element({className:V,tag:"span",title:o.PageConfig.getOption("preferredPath")||"Jupyter Preferred Path",stylesheet:"breadCrumb"})]},e.createCrumbSeparators=function(){const e=[];for(let t=0;t<4;t++){const t=document.createElement("span");t.textContent="/",e.push(t)}return e}}(G||(G={}));var Z=s(60032),Q=s(38047),ee=s(74299);const te="jp-DirListing-header",se="jp-DirListing-headerItem",ie="jp-DirListing-headerItemText",ne="jp-DirListing-headerItemIcon",re="jp-DirListing-content",oe="jp-DirListing-itemText",ae="jp-DirListing-itemIcon",le="jp-DirListing-itemModified",de="jp-DirListing-itemFileSize",he="jp-DirListing-checkboxWrapper",ce="jp-id-name",me="jp-id-modified",ue="jp-id-filesize",pe="jp-LastModified-hidden",ge="jp-FileSize-hidden",_e="application/x-jupyter-icontents",fe="jp-mod-dropTarget",ve="jp-mod-selected",ye="jp-mod-cut",be="jp-mod-multiSelected",we="jp-mod-running",Ce="jp-mod-descending",Ee=!!navigator.platform.match(/Mac/i);class Pe extends c.Widget{constructor(e){super({node:(e.renderer||Pe.defaultRenderer).createNode()}),this._items=[],this._sortedItems=[],this._sortState={direction:"ascending",key:"name"},this._onItemOpened=new h.Signal(this),this._drag=null,this._dragData=null,this._selectTimer=-1,this._isCut=!1,this._prevPath="",this._clipboard=[],this._softSelection="",this.selection=Object.create(null),this._searchPrefix="",this._searchPrefixTimer=-1,this._inRename=!1,this._isDirty=!1,this._hiddenColumns=new Set,this._sortNotebooksFirst=!1,this._focusIndex=0,this.addClass("jp-DirListing"),this.translator=e.translator||_.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._model=e.model,this._model.fileChanged.connect(this._onFileChanged,this),this._model.refreshed.connect(this._onModelRefreshed,this),this._model.pathChanged.connect(this._onPathChanged,this),this._editNode=document.createElement("input"),this._editNode.className="jp-DirListing-editor",this._manager=this._model.manager,this._renderer=e.renderer||Pe.defaultRenderer,this._updateModifiedSize(this.node);const t=I.DOMUtils.findElement(this.node,te);this._hiddenColumns.add("file_size"),this._renderer.populateHeaderNode(t,this.translator,this._hiddenColumns),this._manager.activateRequested.connect(this._onActivateRequested,this)}dispose(){this._items.length=0,this._sortedItems.length=0,this._clipboard.length=0,super.dispose()}get model(){return this._model}get headerNode(){return I.DOMUtils.findElement(this.node,te)}get contentNode(){return I.DOMUtils.findElement(this.node,re)}get renderer(){return this._renderer}get sortState(){return this._sortState}get onItemOpened(){return this._onItemOpened}selectedItems(){const e=this._sortedItems;return(0,a.filter)(e,(e=>this.selection[e.path]))}sortedItems(){return this._sortedItems[Symbol.iterator]()}sort(e){this._sortedItems=xe.sort(this.model.items(),e,this._sortNotebooksFirst),this._sortState=e,this.update()}rename(){return this._doRename()}cut(){this._isCut=!0,this._copy(),this.update()}copy(){this._copy()}paste(){if(!this._clipboard.length)return this._isCut=!1,Promise.resolve(void 0);const e=this._model.path,t=[];for(const s of this._clipboard)if(this._isCut){const i=this._manager.services.contents.localPath(s).split("/"),n=i[i.length-1],r=o.PathExt.join(e,n);t.push(this._model.manager.rename(s,r))}else t.push(this._model.manager.copy(s,e));for(const e of this._items)e.classList.remove(ye);return this._clipboard.length=0,this._isCut=!1,this.removeClass("jp-mod-clipboard"),Promise.all(t).then((()=>{})).catch((e=>{(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Paste Error"),e)}))}async delete(){const e=this._sortedItems.filter((e=>this.selection[e.path]));if(!e.length)return;const t=1===e.length?this._trans.__("Are you sure you want to permanently delete: %1?",e[0].name):this._trans._n("Are you sure you want to permanently delete the %1 selected item?","Are you sure you want to permanently delete the %1 selected items?",e.length),s=await(0,I.showDialog)({title:this._trans.__("Delete"),body:t,buttons:[I.Dialog.cancelButton({label:this._trans.__("Cancel")}),I.Dialog.warnButton({label:this._trans.__("Delete")})],defaultButton:0});!this.isDisposed&&s.button.accept&&await this._delete(e.map((e=>e.path)));let i=this._focusIndex;const n=this._sortedItems.length-e.length-1;i>n&&(i=Math.max(0,n)),this._focusItem(i)}duplicate(){const e=this._model.path,t=[];for(const s of this.selectedItems())"directory"!==s.type&&t.push(this._model.manager.copy(s.path,e));return Promise.all(t).then((()=>{})).catch((e=>{(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Duplicate file"),e)}))}async download(){await Promise.all(Array.from(this.selectedItems()).filter((e=>"directory"!==e.type)).map((e=>this._model.download(e.path))))}shutdownKernels(){const e=this._model,t=this._sortedItems,s=t.map((e=>e.path)),i=Array.from(this._model.sessions()).filter((e=>{const i=a.ArrayExt.firstIndexOf(s,e.path);return this.selection[t[i].path]})).map((t=>e.manager.services.sessions.shutdown(t.id)));return Promise.all(i).then((()=>{})).catch((e=>{(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Shut down kernel"),e)}))}selectNext(e=!1){let t=-1;const s=Object.keys(this.selection),i=this._sortedItems;if(1===s.length||e){const e=s[s.length-1];t=a.ArrayExt.findFirstIndex(i,(t=>t.path===e)),t+=1,t===this._items.length&&(t=0)}else if(0===s.length)t=0;else{const e=s[s.length-1];t=a.ArrayExt.findFirstIndex(i,(t=>t.path===e))}-1!==t&&(this._selectItem(t,e),K.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[t]))}selectPrevious(e=!1){let t=-1;const s=Object.keys(this.selection),i=this._sortedItems;if(1===s.length||e){const e=s[0];t=a.ArrayExt.findFirstIndex(i,(t=>t.path===e)),t-=1,-1===t&&(t=this._items.length-1)}else if(0===s.length)t=this._items.length-1;else{const e=s[0];t=a.ArrayExt.findFirstIndex(i,(t=>t.path===e))}-1!==t&&(this._selectItem(t,e),K.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[t]))}selectByPrefix(){const e=this._searchPrefix.toLowerCase(),t=this._sortedItems,s=a.ArrayExt.findFirstIndex(t,(t=>t.name.toLowerCase().substr(0,e.length)===e));-1!==s&&(this._selectItem(s,!1),K.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[s]))}isSelected(e){const t=this._sortedItems;return 0!==Array.from((0,a.filter)(t,(t=>t.name===e&&this.selection[t.path]))).length}modelForClick(e){const t=this._sortedItems,s=xe.hitTestNodes(this._items,e);if(-1!==s)return t[s]}clearSelectedItems(){this.selection=Object.create(null)}async selectItemByName(e,t=!1){return this._selectItemByName(e,t)}async _selectItemByName(e,t=!1,s=!1){if(!s&&this.isSelected(e))return;if(await this.model.refresh(),this.isDisposed)throw new Error("File browser is disposed.");const i=this._sortedItems,n=a.ArrayExt.findFirstIndex(i,(t=>t.name===e));if(-1===n)throw new Error("Item does not exist.");this._selectItem(n,!1,t),l.MessageLoop.sendMessage(this,c.Widget.Msg.UpdateRequest),K.ElementExt.scrollIntoViewIfNeeded(this.contentNode,this._items[n])}handleEvent(e){switch(e.type){case"mousedown":this._evtMousedown(e);break;case"mouseup":this._evtMouseup(e);break;case"mousemove":this._evtMousemove(e);break;case"keydown":this.evtKeydown(e);break;case"click":this._evtClick(e);break;case"dblclick":this.evtDblClick(e);break;case"dragenter":case"dragover":this.addClass("jp-mod-native-drop"),e.preventDefault();break;case"dragleave":case"dragend":this.removeClass("jp-mod-native-drop");break;case"drop":this.removeClass("jp-mod-native-drop"),this.evtNativeDrop(e);break;case"scroll":this._evtScroll(e);break;case"lm-dragenter":this.evtDragEnter(e);break;case"lm-dragleave":this.evtDragLeave(e);break;case"lm-dragover":this.evtDragOver(e);break;case"lm-drop":this.evtDrop(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node,s=I.DOMUtils.findElement(t,re);t.addEventListener("mousedown",this),t.addEventListener("keydown",this),t.addEventListener("click",this),t.addEventListener("dblclick",this),s.addEventListener("dragenter",this),s.addEventListener("dragover",this),s.addEventListener("dragleave",this),s.addEventListener("dragend",this),s.addEventListener("drop",this),s.addEventListener("scroll",this),s.addEventListener("lm-dragenter",this),s.addEventListener("lm-dragleave",this),s.addEventListener("lm-dragover",this),s.addEventListener("lm-drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node,s=I.DOMUtils.findElement(t,re);t.removeEventListener("mousedown",this),t.removeEventListener("keydown",this),t.removeEventListener("click",this),t.removeEventListener("dblclick",this),s.removeEventListener("scroll",this),s.removeEventListener("dragover",this),s.removeEventListener("dragover",this),s.removeEventListener("dragleave",this),s.removeEventListener("dragend",this),s.removeEventListener("drop",this),s.removeEventListener("lm-dragenter",this),s.removeEventListener("lm-dragleave",this),s.removeEventListener("lm-dragover",this),s.removeEventListener("lm-drop",this),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)}onAfterShow(e){this._isDirty&&(this.sort(this.sortState),this.update())}_updateModifiedSize(e){var t;const s=I.DOMUtils.findElement(e,me);this._modifiedWidth=null!==(t=null==s?void 0:s.getBoundingClientRect().width)&&void 0!==t?t:83,this._modifiedStyle=this._modifiedWidth<100?"narrow":this._modifiedWidth>120?"long":"short"}updateModified(e,t){e.forEach(((e,s)=>{const i=t[s];if(i&&e.last_modified){const t=I.DOMUtils.findElement(i,le);void 0!==this.renderer.updateItemModified?this.renderer.updateItemModified(t,e.last_modified,this._modifiedStyle):Pe.defaultRenderer.updateItemModified(t,e.last_modified,this._modifiedStyle)}}))}updateNodes(e,t){var s;e.forEach(((e,s)=>{const i=t[s],n=this._manager.registry.getFileTypeForModel(e);this.renderer.updateItemNode(i,e,n,this.translator,this._hiddenColumns,this.selection[e.path],this._modifiedStyle),this.selection[e.path]&&this._isCut&&this._model.path===this._prevPath&&i.classList.add(ye),i.setAttribute("data-isdir","directory"===e.type?"true":"false")}));const i=Object.keys(this.selection).length;i&&(this.addClass(ve),i>1&&this.addClass(be));const n=e.map((e=>e.path));for(const e of this._model.sessions()){const i=a.ArrayExt.firstIndexOf(n,e.path),r=t[i];if(r){let t=null===(s=e.kernel)||void 0===s?void 0:s.name;const i=this._model.specs;if(r.classList.add(we),i&&t){const e=i.kernelspecs[t];t=e?e.display_name:this._trans.__("unknown")}r.title=this._trans.__("%1\nKernel: %2",r.title,t)}}}onUpdateRequest(e){this._isDirty=!1;const t=this._sortedItems,s=this._items,i=I.DOMUtils.findElement(this.node,re),n=this._renderer;for(this.removeClass(be),this.removeClass(ve);s.length>t.length;)i.removeChild(s.pop());for(;s.length<t.length;){const e=n.createItemNode(this._hiddenColumns);e.classList.add("jp-DirListing-item"),s.push(e),i.appendChild(e)}s.forEach(((e,t)=>{e.classList.remove(ve),e.classList.remove(we),e.classList.remove(ye);const s=n.getCheckboxNode(e);s&&(s.checked=!1);const i=n.getNameNode(e);i&&(i.tabIndex=t===this._focusIndex?0:-1)}));const r=n.getCheckboxNode(this.headerNode);if(r){const e=Object.keys(this.selection).length,s=t.length>0&&e===t.length,i=!s&&e>0;r.checked=s,r.indeterminate=i,r.dataset.checked=String(s),r.dataset.indeterminate=String(i);const n=this.translator.load("jupyterlab");null==r||r.setAttribute("aria-label",s||i?n.__("Deselect all files and directories"):n.__("Select all files and directories"))}this.updateNodes(t,s),this._prevPath=this._model.path}onResize(e){const{width:t}=-1===e.width?this.node.getBoundingClientRect():e;this.toggleClass("jp-DirListing-narrow",t<250);const s=this._modifiedStyle;this._updateModifiedSize(this.node),s!==this._modifiedStyle&&this.updateModified(this._sortedItems,this._items)}setColumnVisibility(e,t){t?this._hiddenColumns.delete(e):this._hiddenColumns.add(e),this.headerNode.innerHTML="",this._renderer.populateHeaderNode(this.headerNode,this.translator,this._hiddenColumns)}setNotebooksFirstSorting(e){let t=this._sortNotebooksFirst;this._sortNotebooksFirst=e,this._sortNotebooksFirst!==t&&this.sort(this._sortState)}isWithinCheckboxHitArea(e){let t=e.target;for(;t;){if(t.classList.contains(he))return!0;t=t.parentElement}return!1}_evtClick(e){const t=e.target,s=this.headerNode,i=this._renderer;if(s.contains(t)){const t=i.getCheckboxNode(s);if(t&&this.isWithinCheckboxHitArea(e))"false"===t.dataset.indeterminate&&"false"===t.dataset.checked?this._sortedItems.forEach((e=>this.selection[e.path]=!0)):this.clearSelectedItems(),this.update();else{const t=this.renderer.handleHeaderClick(s,e);t&&this.sort(t)}}else this._focusItem(this._focusIndex)}_evtScroll(e){this.headerNode.scrollLeft=this.contentNode.scrollLeft}_evtMousedown(e){if(e.target===this._editNode)return;if(this._editNode.parentNode){if(this._editNode===e.target)return;this._editNode.focus(),this._editNode.blur(),clearTimeout(this._selectTimer)}let t=xe.hitTestNodes(this._items,e);-1!==t&&(this.handleFileSelect(e),0!==e.button&&clearTimeout(this._selectTimer),Ee&&e.ctrlKey||2===e.button||0===e.button&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:t},document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)))}_evtMouseup(e){if(this._softSelection&&(e.metaKey||e.shiftKey||e.ctrlKey||0!==e.button||(this.clearSelectedItems(),this.selection[this._softSelection]=!0,this.update()),this._softSelection=""),0===e.button&&this._focusItem(this._focusIndex),0!==e.button||!this._drag)return document.removeEventListener("mousemove",this,!0),void document.removeEventListener("mouseup",this,!0);e.preventDefault(),e.stopPropagation()}_evtMousemove(e){if(e.preventDefault(),e.stopPropagation(),this._drag||!this._dragData)return;const t=this._dragData,s=Math.abs(e.clientX-t.pressX),i=Math.abs(e.clientY-t.pressY);s<5&&i<5||this._startDrag(t.index,e.clientX,e.clientY)}handleOpen(e){if(this._onItemOpened.emit(e),"directory"===e.type){const t=this._manager.services.contents.localPath(e.path);this._model.cd(`/${t}`).catch((e=>(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Open directory"),e)))}else{const t=e.path;this._manager.openOrReveal(t)}}_getNextFocusIndex(e,t){const s=e+t;return-1===s||s===this._items.length?e:s}_handleArrowY(e,t){if(e.altKey||e.metaKey)return;if(!this._items.length)return;if(!e.target.classList.contains(oe))return;e.stopPropagation(),e.preventDefault();const s=this._focusIndex;let i=this._getNextFocusIndex(s,t);t>0&&0===s&&!e.ctrlKey&&0===Object.keys(this.selection).length&&(i=0),e.shiftKey?this._handleMultiSelect(i):e.ctrlKey||this._selectItem(i,e.shiftKey,!1),this._focusItem(i),this.update()}async goUp(){const e=this.model;if(e.path!==e.rootPath)try{await e.cd("..")}catch(t){console.warn(`Failed to go to parent directory of ${e.path}`,t)}}evtKeydown(e){if(!this._inRename){switch(e.keyCode){case 13:if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;e.preventDefault(),e.stopPropagation();for(const e of this.selectedItems())this.handleOpen(e);return;case 38:return void this._handleArrowY(e,-1);case 40:return void this._handleArrowY(e,1);case 32:if(e.ctrlKey){if(e.metaKey||e.shiftKey||e.altKey)return;const t=this._items[this._focusIndex];if(!t.contains(e.target)||!t.contains(document.activeElement))return;e.stopPropagation(),e.preventDefault();const{path:s}=this._sortedItems[this._focusIndex];return this.selection[s]?delete this.selection[s]:this.selection[s]=!0,void this.update()}}if(void 0!==e.key&&1===e.key.length&&(" "!==e.key&&32!==e.keyCode||"checkbox"!==e.target.type)){if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;this._searchPrefix+=e.key,clearTimeout(this._searchPrefixTimer),this._searchPrefixTimer=window.setTimeout((()=>{this._searchPrefix=""}),1e3),this.selectByPrefix(),e.stopPropagation(),e.preventDefault()}}}evtDblClick(e){if(0!==e.button)return;if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;if(this.isWithinCheckboxHitArea(e))return;e.preventDefault(),e.stopPropagation(),clearTimeout(this._selectTimer),this._editNode.blur();const t=e.target,s=a.ArrayExt.findFirstIndex(this._items,(e=>e.contains(t)));if(-1===s)return;const i=this._sortedItems[s];this.handleOpen(i)}evtNativeDrop(e){var t,s,i;const n=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;if(!n||0===n.length)return;const r=null===(s=e.dataTransfer)||void 0===s?void 0:s.items.length;if(r){for(let t=0;t<r;t++){let s=null===(i=e.dataTransfer)||void 0===i?void 0:i.items[t].webkitGetAsEntry();(null==s?void 0:s.isDirectory)&&(console.log("currently not supporting drag + drop for folders"),(0,I.showDialog)({title:this._trans.__("Error Uploading Folder"),body:this._trans.__("Drag and Drop is currently not supported for folders"),buttons:[I.Dialog.cancelButton({label:this._trans.__("Close")})]}))}e.preventDefault();for(let e=0;e<n.length;e++)this._model.upload(n[e])}}evtDragEnter(e){if(e.mimeData.hasData(_e)){const t=xe.hitTestNodes(this._items,e);if(-1===t)return;const s=this._sortedItems[t];if("directory"!==s.type||this.selection[s.path])return;e.target.classList.add(fe),e.preventDefault(),e.stopPropagation()}}evtDragLeave(e){e.preventDefault(),e.stopPropagation();const t=I.DOMUtils.findElement(this.node,fe);t&&t.classList.remove(fe)}evtDragOver(e){e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=I.DOMUtils.findElement(this.node,fe);t&&t.classList.remove(fe);const s=xe.hitTestNodes(this._items,e);this._items[s].classList.add(fe)}evtDrop(e){if(e.preventDefault(),e.stopPropagation(),clearTimeout(this._selectTimer),"none"===e.proposedAction)return void(e.dropAction="none");if(!e.mimeData.hasData(_e))return;let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(fe)){t.classList.remove(fe);break}t=t.parentElement}const s=a.ArrayExt.firstIndexOf(this._items,t),i=this._sortedItems;let n=this._model.path;"directory"===i[s].type&&(n=o.PathExt.join(n,i[s].name));const r=this._manager,l=[],d=e.mimeData.getData(_e);e.ctrlKey&&"move"===e.proposedAction?e.dropAction="copy":e.dropAction=e.proposedAction;for(const t of d){const s=r.services.contents.localPath(t),i=o.PathExt.basename(s),a=o.PathExt.join(n,i);a!==t&&("copy"===e.dropAction?l.push(r.copy(t,n)):l.push((0,H.H5)(r,t,a)))}Promise.all(l).catch((e=>{(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Error while copying/moving files"),e)}))}_startDrag(e,t,s){let i=Object.keys(this.selection);const r=this._items[e],o=this._sortedItems;let a,l;if(r.classList.contains(ve)){const e=i[0];l=o.find((t=>t.path===e)),a=this.selectedItems()}else l=o[e],i=[l.path],a=[l];if(!l)return;const d=this._manager.registry.getFileTypeForModel(l),h=this.renderer.createDragImage(r,i.length,this._trans,d);this._drag=new Q.Drag({dragImage:h,mimeData:new n.MimeData,supportedActions:"move",proposedAction:"move"}),this._drag.mimeData.setData(_e,i);const c=this.model.manager.services;for(const e of a)this._drag.mimeData.setData("application/x-jupyter-icontentsrich",{model:e,withContent:async()=>await c.contents.get(e.path)});if(l&&"directory"!==l.type){const e=i.slice(1).reverse();this._drag.mimeData.setData("application/vnd.lumino.widget-factory",(()=>{if(!l)return;const t=l.path;let s=this._manager.findWidget(t);if(s||(s=this._manager.open(l.path)),e.length){const t=new n.PromiseDelegate;t.promise.then((()=>{let t=s;e.forEach((e=>{const s={ref:null==t?void 0:t.id,mode:"tab-after"};t=this._manager.openOrReveal(e,void 0,void 0,s),this._manager.openOrReveal(l.path)}))})),t.resolve(void 0)}return s}))}document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),clearTimeout(this._selectTimer),this._drag.start(t,s).then((e=>{this._drag=null,clearTimeout(this._selectTimer)}))}handleFileSelect(e){const t=this._sortedItems,s=xe.hitTestNodes(this._items,e);if(clearTimeout(this._selectTimer),-1===s)return;this._softSelection="";const i=t[s].path,n=Object.keys(this.selection),r=0===e.button&&!(Ee&&e.ctrlKey)&&this.isWithinCheckboxHitArea(e);if(Ee&&e.metaKey||!Ee&&e.ctrlKey||r)this.selection[i]?delete this.selection[i]:this.selection[i]=!0,this._focusItem(s);else if(e.shiftKey)this._handleMultiSelect(s),this._focusItem(s);else{if(!(i in this.selection&&n.length>1))return this._selectItem(s,!1,!0);this._softSelection=i}this.update()}_focusItem(e){const t=this._items;if(0===t.length)return this._focusIndex=0,void this.node.focus();this._focusIndex=e;const s=t[e],i=this.renderer.getNameNode(s);i&&(i.tabIndex=0,i.focus())}_allSelectedBetween(e,t){if(e===t)return;const[s,i]=e<t?[e+1,t]:[t+1,e];return this._sortedItems.slice(s,i).reduce(((e,t)=>e&&this.selection[t.path]),!0)}_handleMultiSelect(e){const t=this._sortedItems,s=this._focusIndex,i=t[e];let n=!0;if(e===s)return void(this.selection[i.path]=!0);if(this.selection[i.path])if(1===Math.abs(e-s)){const i=t[s],n=t[s+(e<s?1:-1)];!this.selection[i.path]||n&&this.selection[n.path]||delete this.selection[i.path]}else this._allSelectedBetween(s,e)&&(n=!1);const r=s<e?1:-1;for(let i=s;i!==e+r;i+=r)if(n){if(i===s)continue;this.selection[t[i].path]=!0}else{if(i===e)continue;delete this.selection[t[i].path]}}_copy(){this._clipboard.length=0;for(const e of this.selectedItems())this._clipboard.push(e.path)}async _delete(e){await Promise.all(e.map((e=>this._model.manager.deleteFile(e).catch((e=>{(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Delete Failed"),e)})))))}async _doRename(){this._inRename=!0;const e=Object.keys(this.selection);if(0===e.length)return this._inRename=!1,Promise.resolve("");const t=this._sortedItems;let{path:s}=t[this._focusIndex];this.selection[s]||(s=e.slice(-1)[0]);const i=a.ArrayExt.findFirstIndex(t,(e=>e.path===s)),n=this._items[i],r=t[i],l=this.renderer.getNameNode(n),d=r.name;this._editNode.value=d,this._selectItem(i,!1,!0);const h=await xe.userInputForRename(l,this._editNode,d);if(this.isDisposed)throw this._inRename=!1,new Error("File browser is disposed.");let c=h;if(h&&h!==d)if((0,H.Ix)(h)){const e=this._manager,t=o.PathExt.join(this._model.path,d),s=o.PathExt.join(this._model.path,h);try{await(0,H.H5)(e,t,s)}catch(e){"File not renamed"!==e&&(0,I.showErrorMessage)(this._trans._p("showErrorMessage","Rename Error"),e),c=d}if(this.isDisposed)throw this._inRename=!1,new Error("File browser is disposed.")}else(0,I.showErrorMessage)(this._trans.__("Rename Error"),Error(this._trans._p("showErrorMessage",'"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',h))),c=d;else c=d;if(!this.isDisposed&&1===Object.keys(this.selection).length&&this.selection[r.path])try{await this._selectItemByName(c,!0,!0)}catch(e){console.warn("After rename, failed to select file",c)}return this._inRename=!1,c}_selectItem(e,t,s=!0){const i=this._sortedItems;t||this.clearSelectedItems();const n=i[e].path;this.selection[n]=!0,s&&this._focusItem(e),this.update()}_onModelRefreshed(){const e=Object.keys(this.selection);this.clearSelectedItems();for(const t of this._model.items()){const s=t.path;-1!==e.indexOf(s)&&(this.selection[s]=!0)}this.isVisible?this.sort(this.sortState):this._isDirty=!0}_onPathChanged(){this.clearSelectedItems(),this.sort(this.sortState),requestAnimationFrame((()=>{this._focusItem(0)}))}_onFileChanged(e,t){const s=t.newValue;if(!s)return;const i=s.name;"new"===t.type&&i&&this.selectItemByName(i).catch((()=>{}))}_onActivateRequested(e,t){if(o.PathExt.dirname(t)!==this._model.path)return;const s=o.PathExt.basename(t);this.selectItemByName(s).catch((()=>{}))}}var xe;!function(e){class t{createNode(){const e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("ul");return s.setAttribute("data-lm-dragscroll","true"),s.className=re,t.className=te,e.appendChild(t),e.appendChild(s),e.tabIndex=-1,e}populateHeaderNode(e,t,s){const i=(t=t||_.nullTranslator).load("jupyterlab"),n=this.createHeaderItemNode(i.__("Name")),r=document.createElement("div"),o=this._createHeaderItemNodeWithSizes({small:i.__("Modified"),large:i.__("Last Modified")}),a=this.createHeaderItemNode(i.__("File Size"));if(n.classList.add(ce),n.classList.add(ve),o.classList.add(me),a.classList.add(ue),r.classList.add("jp-id-narrow"),r.textContent="...",!(null==s?void 0:s.has("is_selected"))){const t=this.createCheckboxWrapperNode({alwaysVisible:!0,headerNode:!0});e.appendChild(t)}e.appendChild(n),e.appendChild(r),e.appendChild(o),e.appendChild(a),(null==s?void 0:s.has("last_modified"))?o.classList.add(pe):o.classList.remove(pe),(null==s?void 0:s.has("file_size"))?a.classList.add(ge):a.classList.remove(ge),xe.updateCaret(I.DOMUtils.findElement(n,ne),"right","up")}handleHeaderClick(e,t){const s=I.DOMUtils.findElement(e,ce),i=I.DOMUtils.findElement(e,me),n=I.DOMUtils.findElement(e,ue),r={direction:"ascending",key:"name"},o=t.target,a=I.DOMUtils.findElement(i,ne),l=I.DOMUtils.findElement(n,ne),d=I.DOMUtils.findElement(s,ne);return s.contains(o)?(s.classList.contains(ve)?s.classList.contains(Ce)?(s.classList.remove(Ce),xe.updateCaret(d,"right","up")):(r.direction="descending",s.classList.add(Ce),xe.updateCaret(d,"right","down")):(s.classList.remove(Ce),xe.updateCaret(d,"right","up")),s.classList.add(ve),i.classList.remove(ve),i.classList.remove(Ce),n.classList.remove(ve),n.classList.remove(Ce),xe.updateCaret(a,"left"),xe.updateCaret(l,"left"),r):i.contains(o)?(r.key="last_modified",i.classList.contains(ve)?i.classList.contains(Ce)?(i.classList.remove(Ce),xe.updateCaret(a,"left","up")):(r.direction="descending",i.classList.add(Ce),xe.updateCaret(a,"left","down")):(i.classList.remove(Ce),xe.updateCaret(a,"left","up")),i.classList.add(ve),s.classList.remove(ve),s.classList.remove(Ce),n.classList.remove(ve),n.classList.remove(Ce),xe.updateCaret(d,"right"),xe.updateCaret(l,"left"),r):n.contains(o)?(r.key="file_size",n.classList.contains(ve)?n.classList.contains(Ce)?(n.classList.remove(Ce),xe.updateCaret(l,"left","up")):(r.direction="descending",n.classList.add(Ce),xe.updateCaret(l,"left","down")):(n.classList.remove(Ce),xe.updateCaret(l,"left","up")),n.classList.add(ve),s.classList.remove(ve),s.classList.remove(Ce),i.classList.remove(ve),i.classList.remove(Ce),xe.updateCaret(d,"right"),xe.updateCaret(a,"left"),r):r}createItemNode(e){const t=document.createElement("li"),s=document.createElement("span"),i=document.createElement("span"),n=document.createElement("span"),r=document.createElement("span");if(s.className=ae,i.className=oe,n.className=le,r.className=de,!(null==e?void 0:e.has("is_selected"))){const e=this.createCheckboxWrapperNode();t.appendChild(e)}return t.appendChild(s),t.appendChild(i),t.appendChild(n),t.appendChild(r),(null==e?void 0:e.has("last_modified"))?n.classList.add(pe):n.classList.remove(pe),(null==e?void 0:e.has("file_size"))?r.classList.add(ge):r.classList.remove(ge),t}createCheckboxWrapperNode(e){const t=document.createElement("label");t.classList.add(he);const s=document.createElement("input");return s.type="checkbox",(null==e?void 0:e.headerNode)||s.addEventListener("click",(e=>{e.preventDefault()})),(null==e?void 0:e.alwaysVisible)?t.classList.add("jp-mod-visible"):s.tabIndex=-1,t.appendChild(s),t}updateItemModified(e,t,s){let i="",n="";const r=new Date(t);i=o.Time.formatHuman(r,s),n=o.Time.format(r),e.textContent=i,e.title=n}updateItemNode(e,t,s,i,n,r,l){r&&e.classList.add(ve),s=s||Z.DocumentRegistry.getDefaultTextFileType(i);const{icon:d,iconClass:h,name:c}=s,m=(i=i||_.nullTranslator).load("jupyterlab"),u=I.DOMUtils.findElement(e,ae),p=I.DOMUtils.findElement(e,oe),g=I.DOMUtils.findElement(e,le),f=I.DOMUtils.findElement(e,de),v=I.DOMUtils.findElement(e,he),y=!(null==n?void 0:n.has("is_selected"));if(v&&!y)e.removeChild(v);else if(y&&!v){const t=this.createCheckboxWrapperNode();e.insertBefore(t,u)}(null==n?void 0:n.has("last_modified"))?g.classList.add(pe):g.classList.remove(pe),(null==n?void 0:n.has("file_size"))?f.classList.add(ge):f.classList.remove(ge),W.LabIcon.resolveElement({icon:d,iconClass:(0,W.classes)(h,"jp-Icon"),container:u,className:ae,stylesheet:"listing"});let b=m.__("Name: %1",t.name);if(null!==t.size&&void 0!==t.size){const e=xe.formatFileSize(t.size,1,1024);f.textContent=e,b+=m.__("\nSize: %1",xe.formatFileSize(t.size,1,1024))}else f.textContent="";if(t.path){const e=o.PathExt.dirname(t.path);e&&(b+=m.__("\nPath: %1",e.substr(0,50)),e.length>50&&(b+="..."))}t.created&&(b+=m.__("\nCreated: %1",o.Time.format(new Date(t.created)))),t.last_modified&&(b+=m.__("\nModified: %1",o.Time.format(new Date(t.last_modified)))),b+=m.__("\nWritable: %1",t.writable),e.title=b,e.setAttribute("data-file-type",c),t.name.startsWith(".")?e.setAttribute("data-is-dot","true"):e.removeAttribute("data-is-dot");const w=t.indices?t.indices:[];let C=a.StringExt.highlight(t.name,w,ee.h.mark);p&&ee.VirtualDOM.render(ee.h.span(C),p);const E=null==v?void 0:v.querySelector('input[type="checkbox"]');if(E){let e;e="directory"===s.contentType?r?m.__('Deselect directory "%1"',C):m.__('Select directory "%1"',C):r?m.__('Deselect file "%1"',C):m.__('Select file "%1"',C),E.setAttribute("aria-label",e),E.checked=null!=r&&r}t.last_modified&&this.updateItemModified(g,t.last_modified,null!=l?l:"short")}getNameNode(e){return I.DOMUtils.findElement(e,oe)}getCheckboxNode(e){return e.querySelector(`.${he} input[type=checkbox]`)}createDragImage(e,t,s,i){const n=e.cloneNode(!0),r=I.DOMUtils.findElement(n,le),o=I.DOMUtils.findElement(n,ae);return n.removeChild(r),i?(o.textContent=i.iconLabel||"",o.className=i.iconClass||""):(o.textContent="",o.className=""),o.classList.add("jp-DragIcon"),t>1&&(I.DOMUtils.findElement(n,oe).textContent=s._n("%1 Item","%1 Items",t)),n}createHeaderItemNode(e){const t=document.createElement("div"),s=document.createElement("span"),i=document.createElement("span");return t.className=se,s.className=ie,i.className=ne,s.textContent=e,t.appendChild(s),t.appendChild(i),t}_createHeaderItemNodeWithSizes(e){const t=document.createElement("div");t.className=se;const s=document.createElement("span");s.className=ne;for(let s of Object.keys(e)){const i=document.createElement("span");i.classList.add(ie,ie+"-"+s),i.textContent=e[s],t.appendChild(i)}return t.appendChild(s),t}}e.Renderer=t,e.defaultRenderer=new t}(Pe||(Pe={})),function(e){e.userInputForRename=function(e,t,s){const i=e.parentElement;i.replaceChild(t,e),t.focus();const n=t.value.lastIndexOf(".");return-1===n?t.setSelectionRange(0,t.value.length):t.setSelectionRange(0,n),new Promise((n=>{t.onblur=()=>{i.replaceChild(e,t),n(t.value)},t.onkeydown=i=>{switch(i.keyCode){case 13:i.stopPropagation(),i.preventDefault(),t.blur();break;case 27:i.stopPropagation(),i.preventDefault(),t.value=s,t.blur(),e.focus()}}}))},e.sort=function(e,t,s=!1){const i=Array.from(e),n="descending"===t.direction?1:-1;function r(e){return"directory"===e.type?2:"notebook"===e.type&&s?1:0}function o(e){return(t,i)=>{if(function(e,t){return s?e.type!==t.type:"directory"===e.type!=("directory"===t.type)}(t,i))return r(i)-r(t);const o=e(t,i);return 0!==o?o*n:t.name.localeCompare(i.name)}}return"last_modified"===t.key?i.sort(o(((e,t)=>new Date(e.last_modified).getTime()-new Date(t.last_modified).getTime()))):"file_size"===t.key?i.sort(o(((e,t)=>{var s,i;return(null!==(s=e.size)&&void 0!==s?s:0)-(null!==(i=t.size)&&void 0!==i?i:0)}))):i.sort(o(((e,t)=>t.name.localeCompare(e.name)))),i},e.hitTestNodes=function(e,t){return a.ArrayExt.findFirstIndex(e,(e=>K.ElementExt.hitTest(e,t.clientX,t.clientY)||t.target===e))},e.formatFileSize=function(e,t,s){if(0===e)return"0 B";const i=t||2,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(s));return r>=0&&r<n.length?parseFloat((e/Math.pow(s,r)).toFixed(i))+" "+n[r]:String(e)},e.updateCaret=function(e,t,s){s?("down"===s?W.caretDownIcon:W.caretUpIcon).element({container:e,tag:"span",stylesheet:"listingHeaderItem",float:t}):(W.LabIcon.remove(e),e.className=ne)}}(xe||(xe={}));class Le extends W.SidePanel{constructor(e){var t;super({content:new c.Panel,translator:e.translator}),this._directoryPending=null,this._filePending=null,this._showLastModifiedColumn=!0,this._showFileSizeColumn=!1,this._showHiddenFiles=!1,this._showFileCheckboxes=!1,this._sortNotebooksFirst=!1,this.addClass("jp-FileBrowser"),this.toolbar.addClass("jp-FileBrowser-toolbar"),this.id=e.id;const s=this.translator=null!==(t=e.translator)&&void 0!==t?t:_.nullTranslator,i=this.model=e.model,n=e.renderer;i.connectionFailure.connect(this._onConnectionFailure,this),this._manager=i.manager,this.toolbar.node.setAttribute("aria-label",this._trans.__("file browser")),this.mainPanel=new c.Panel,this.mainPanel.addClass("jp-FileBrowser-Panel"),this.mainPanel.title.label=this._trans.__("File Browser"),this.crumbs=new X({model:i,translator:s}),this.crumbs.addClass("jp-FileBrowser-crumbs"),this.listing=this.createDirListing({model:i,renderer:n,translator:s}),this.listing.addClass("jp-FileBrowser-listing"),this.mainPanel.addWidget(this.crumbs),this.mainPanel.addWidget(this.listing),this.addWidget(this.mainPanel),!1!==e.restore&&i.restore(this.id)}get navigateToCurrentDirectory(){return this._navigateToCurrentDirectory}set navigateToCurrentDirectory(e){this._navigateToCurrentDirectory=e}get showLastModifiedColumn(){return this._showLastModifiedColumn}set showLastModifiedColumn(e){this.listing.setColumnVisibility?(this.listing.setColumnVisibility("last_modified",e),this._showLastModifiedColumn=e):console.warn("Listing does not support toggling column visibility")}get showFullPath(){return this.crumbs.fullPath}set showFullPath(e){this.crumbs.fullPath=e}get showFileSizeColumn(){return this._showFileSizeColumn}set showFileSizeColumn(e){this.listing.setColumnVisibility?(this.listing.setColumnVisibility("file_size",e),this._showFileSizeColumn=e):console.warn("Listing does not support toggling column visibility")}get showHiddenFiles(){return this._showHiddenFiles}set showHiddenFiles(e){this.model.showHiddenFiles(e),this._showHiddenFiles=e}get showFileCheckboxes(){return this._showFileCheckboxes}set showFileCheckboxes(e){this.listing.setColumnVisibility?(this.listing.setColumnVisibility("is_selected",e),this._showFileCheckboxes=e):console.warn("Listing does not support toggling column visibility")}get sortNotebooksFirst(){return this._sortNotebooksFirst}set sortNotebooksFirst(e){this.listing.setNotebooksFirstSorting?(this.listing.setNotebooksFirstSorting(e),this._sortNotebooksFirst=e):console.warn("Listing does not support sorting notebooks first")}selectedItems(){return this.listing.selectedItems()}async selectItemByName(e){await this.listing.selectItemByName(e)}clearSelectedItems(){this.listing.clearSelectedItems()}rename(){return this.listing.rename()}cut(){this.listing.cut()}copy(){this.listing.copy()}paste(){return this.listing.paste()}async _createNew(e){if(e.path){const t=this._manager.services.contents.localPath(e.path);e.path=this._toDrivePath(this.model.driveName,t)}try{const t=await this._manager.newUntitled(e);return await this.listing.selectItemByName(t.name,!0),await this.rename(),t}catch(e){throw(0,I.showErrorMessage)(this._trans.__("Error"),e),e}}async createNewDirectory(){if(this._directoryPending)return this._directoryPending;this._directoryPending=this._createNew({path:this.model.path,type:"directory"});try{return await this._directoryPending}finally{this._directoryPending=null}}async createNewFile(e){if(this._filePending)return this._filePending;this._filePending=this._createNew({path:this.model.path,type:"file",ext:e.ext});try{return await this._filePending}finally{this._filePending=null}}delete(){return this.listing.delete()}duplicate(){return this.listing.duplicate()}download(){return this.listing.download()}async goUp(){return this.listing.goUp()}shutdownKernels(){return this.listing.shutdownKernels()}selectNext(){this.listing.selectNext()}selectPrevious(){this.listing.selectPrevious()}modelForClick(e){return this.listing.modelForClick(e)}createDirListing(e){return new Pe(e)}_onConnectionFailure(e,t){if(t instanceof y.ServerConnection.ResponseError&&404===t.response.status){const e=this._trans.__("Directory not found");t.message=this._trans.__('Directory not found: "%1"',this.model.path),(0,I.showErrorMessage)(e,t)}}_toDrivePath(e,t){return""===e?t:`${e}:${o.PathExt.removeSlash(t)}`}}class De extends Pe{get urlFactory(){return this._urlFactory}set urlFactory(e){this._urlFactory=e}handleOpen(e){if("directory"===e.type){const t=this.model.manager.services.contents.localPath(e.path);this.model.cd(`/${t}`).catch((e=>(0,I.showErrorMessage)("Open directory",e)))}else{const t=e.path;this.urlFactory?window.open(this.urlFactory(t),"_blank"):(0,I.showErrorMessage)("Open file","URL Factory is not defined")}}handleEvent(e){"click"===e.type&&this.evtDblClick(e)}}class Ie extends Le{constructor(e){const{urlFactory:t,title:s}=e;super(function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(s[i[n]]=e[i[n]])}return s}(e,["urlFactory","title"])),this.listing.urlFactory=t,this.addClass("voila-FileBrowser");const i=new c.Widget;i.node.innerText=s,this.toolbar.addItem("title",i)}createDirListing(e){return new De(e)}}},89452:e=>{e.exports={name:"@voila-dashboards/voila",version:"0.5.7",description:"The Voil Frontend",author:"Voil contributors",license:"BSD-3-Clause",main:"lib/index.js",repository:{type:"git",url:"https://github.com/voila-dashboards/voila"},browserslist:">0.8%, not ie 11, not op_mini all, not dead",dependencies:{"@jupyter-widgets/base":"^6.0.6","@jupyter-widgets/jupyterlab-manager":"^5.0.9","@jupyterlab/application":"^4.0.0","@jupyterlab/apputils":"^4.0.0","@jupyterlab/apputils-extension":"^4.0.0","@jupyterlab/codemirror":"^4.0.3","@jupyterlab/codemirror-extension":"^4.0.0","@jupyterlab/coreutils":"^6.0.0","@jupyterlab/docregistry":"^4.0.0","@jupyterlab/javascript-extension":"^4.0.0","@jupyterlab/json-extension":"^4.0.0","@jupyterlab/logconsole":"^4.0.0","@jupyterlab/mainmenu":"^4.0.0","@jupyterlab/markedparser-extension":"^4.0.0","@jupyterlab/mathjax-extension":"^4.0.0","@jupyterlab/mathjax2-extension":"^4.0.0","@jupyterlab/nbformat":"^4.0.0","@jupyterlab/notebook":"^4.0.0","@jupyterlab/outputarea":"^4.0.0","@jupyterlab/rendermime":"^4.0.0","@jupyterlab/rendermime-extension":"^4.0.0","@jupyterlab/services":"^7.0.0","@jupyterlab/settingregistry":"^4.0.0","@jupyterlab/theme-dark-extension":"^4.0.2","@jupyterlab/theme-light-extension":"^4.0.2","@jupyterlab/translation":"^4.0.0","@jupyterlab/ui-components":"^4.0.0","@jupyterlab/vega5-extension":"^4.0.0","@lumino/algorithm":"^2.0.0","@lumino/commands":"^2.0.0","@lumino/coreutils":"^2.0.0","@lumino/datagrid":"^2.1.2","@lumino/disposable":"^2.0.0","@lumino/domutils":"^2.0.0","@lumino/dragdrop":"^2.0.0","@lumino/messaging":"^2.0.0","@lumino/properties":"^2.0.0","@lumino/signaling":"^2.0.0","@lumino/virtualdom":"^2.0.0","@lumino/widgets":"^2.0.0",react:"^18.2.0","react-dom":"^18.2.0","style-mod":"^4.0.3",util:"^0.12.5"},devDependencies:{"@jupyterlab/builder":"^4.0.0","@types/node":"~18.8.3","css-loader":"^6.7.2","fs-extra":"^9.1.0",glob:"~7.1.6","npm-run-all":"^4.1.5","p-limit":"^2.2.2",rimraf:"^3.0.2","style-loader":"~3.3.1","tsc-watch":"^6.0.0",typescript:"~5.0.2",watch:"^1.0.2",webpack:"^5.24.1","webpack-bundle-analyzer":"^4.4.0","webpack-cli":"^4.5.0","webpack-merge":"^5.7.3","whatwg-fetch":"^3.0.0"},scripts:{build:"npm run build:lib && webpack --mode=development","build:lib":"tsc","build:prod":"npm run build:lib && webpack --mode=production",clean:"jlpm run clean:lib && jlpm run clean:asset && rimraf build","clean:lib":"rimraf lib tsconfig.tsbuildinfo","clean:asset":"rimraf ../../share/jupyter/voila/schemas ../../share/jupyter/voila/themes ../../share/jupyter/voila/style.js",test:'echo "Error: no test specified" && exit 1',watch:'tsc-watch --onSuccess "webpack --mode=development"',"watch:lib":"tsc -w","watch:bundle":"webpack --watch --mode=development"}}}}]);